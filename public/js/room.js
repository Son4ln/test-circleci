!function(e){var t={};function s(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=0)}({0:function(e,t,s){e.exports=s("hDgY")},hDgY:function(e,t){var s="";$.listenMessages=function(e){window.Echo.join(e).listen("MessageReceived",function(e){i(e).appendTo("#messages"),$("#messages").scrollTop(1e5)})},$.listenCrluoMessages=function(e){window.Echo.private(e).listen("CrluoMessageReceived",function(t){s=e,i(t).appendTo("#crluo-messages"),$("#crluo-messages").scrollTop(1e5)})};var n=[],a=[],o=$("#creativeroom_id").val();function i(e){var t=$("<div></div>",{class:"flexable margin-15 "+function(e){if($("#user_id").val()==e)return"";return""}(e.message.user_id)});n.length>0&&(e.message.files=n),t.append($("<img>",{src:e.user.photo,class:"user-image"}));var s=$("<div></div>",{class:"message-container"}),a=e.user.name?e.user.name:"";a.length>24&&(a=a.substr(0,21)+"...");var o=$("<h5></h5>").html(a);o.append("&nbsp;&nbsp;&nbsp;&nbsp;"),o.append(e.message.created_at),s.append(o);var i=null!=(i=e.message.message.replace(/\r?\n/g,"<br />"))?i.autoLink({rel:"noopener",target:"_blank"}):"",r=$("<span></span>",{class:"content"}).html(i);if(e.message.files)for(var l=0;l<e.message.files.length;l++)r.append($("<a></a>",{href:e.message.files[l].path,download:e.message.files[l].name}).text(e.message.files[l].name));return s.append(r),t.append(s),t}var r=!0,l=0,c=0,u=!0;$("#document").ready(function(){p(),g(),$("#messages").scrollTop(1e5),$("#messages").scroll(function(){$(this).scrollTop()<300&&u&&h("#messages")}),$("#crluo-messages").scroll(function(){$(this).scrollTop()<300&&u&&h("#crluo-messages")}),$("#crluo_messages").scroll(function(){$(this).scrollTop()<300&&u&&f("#crluo_messages",!1)}),$("#sendmesform").submit(function(e){e.preventDefault();m("#messages")}),$("#input_message").keydown(function(e){var t=this;if((e.metaKey||e.ctrlKey)&&13==e.keyCode){e.preventDefault();m("#messages")}""==$(this).val().trim()||setTimeout(function(){t.style.cssText="height:auto; padding:0",t.style.cssText="height:"+t.scrollHeight+"px"},0)}),document.getElementById("input_message").addEventListener("keydown",function(){var e=this;setTimeout(function(){e.style.cssText="height:auto; padding:0";var t=e.scrollHeight+30;e.style.cssText="height:"+t+"px",""==e.value&&(!1,e.style.cssText="")},0)});$("#sendinfoform").submit(function(e){e.preventDefault();m("#crluo-messages")}),$("#admin_crluo_form").submit(function(e){e.preventDefault(),function(e){var t=$("#crluo_message").val();if(!(t=t.autoLink({rel:"noopener",target:"_blank"})))return;if(!d)return void alert("You type too fast!");d=!1,$(".sending").removeClass("hidden"),$.ajax({url:"/messages/send",type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content"),message:t,creativeroom_id:$("#creativeroom_id").val(),kind:"#messages"==e?1:2,files:JSON.stringify(n),recipient_id:$("#creativeroom_users").val()},success:function(t){$(e).append(t)},error:function(e){function t(t,s){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){var s="";if(422==e.status){var n=e.responseJSON;for(error in n)s+=n[error][0];alert(s)}else alert("メッセージが送信できませんでした!")}),complete:function(){$("textarea").val(""),d=!0,$(".sending").addClass("hidden")}})}("#crluo_messages")}),$('a[href="#work-default"]').click(function(){setTimeout(function(){$("#crluo-messages").scrollTop(1e5),$("#crluo_messages").scrollTop(1e5)},10)}),$('a[href="#work-message"]').click(function(){setTimeout(function(){$("#messages").scrollTop(1e5)},10)}),$(document).on("submit","#project form",function(e){e.preventDefault();var t=$(this).attr("action"),s=new FormData($(this)[0]);$(".preloader").show(),$.ajax({url:t,type:"POST",data:s,processData:!1,contentType:!1,success:function(e){$("#project").modal("hide")},complete:function(){$(".preloader").fadeOut()}})}),$(document).on("click",".tab-toggle",function(e){var t=$(e.target);if("button"===$(this).attr("type")?$("#page-wrapper").addClass("bg-282828"):$("#page-wrapper").removeClass("bg-282828"),$(".task-element").removeClass("l-highlight"),"BUTTON"===t.context.nodeName){var s=t.attr("data-file"),n=t.attr("data-time");if(setTimeout(function(){$(".h-"+n+".le-"+s).addClass("l-highlight")},100),$(".ui-preview-movie").removeClass("active"),$("div[data-fileid|='"+s+"']").trigger("click"),void 0!==n)document.getElementById("pv-video").currentTime=n}$(".tab-toggle").removeClass("active"),$(this).addClass("active"),$(".tab-pane").hide(),$($(this).data("target")).fadeIn(),"#chat"==$(this).data("target")&&$("#messages").scrollTop(1e6)})});var d=!0;function m(e){var t="#messages"==e?$("#input_message").val():$("#crluo_message").val();((t=t.autoLink({rel:"noopener",target:"_blank"}))||r)&&"disabled"!=$("#input_message").attr("disabled")&&($("#input_message").attr("disabled",!0),$("#admin-user-search-btn").addClass("disabled"),$("#input_message").val("送信中です..."),d=!1,$.ajax({url:"/messages/send",type:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content"),message:t,creativeroom_id:$("#creativeroom_id").val(),kind:"#messages"==e?1:2,files:JSON.stringify(n)},success:function(t){$(e).append(t),n.length>0&&(n=[],createdThumbnails=[],$.get("/files/projects/"+o,function(e){$("#content-files_list").html(e)}),$("#input_message").attr({style:""})),$("#input_message").attr("style","")},error:function(e){function t(t,s){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t){var s="";if(422==e.status){var n=e.responseJSON;for(error in n)s+=n[error][0];alert(s)}else alert("メッセージが送信できませんでした!")}),complete:function(){$("textarea").val(""),v.reset(),d=!0,$("#input_message").attr("disabled",!1),$("#admin-user-search-btn").removeClass("disabled"),$("#input_message").val("")}}))}function p(){l=$("#last_message").val(),$("#last_message").remove()}function g(){c=$("#last_crluo_message").val(),$("#last_crluo_message").remove()}function h(e){var t="#messages"==e?l:c;t&&($(".loading-text").removeClass("hidden"),u=!1,$.ajax({url:"/messages/paginate",type:"POST",dataType:"html",data:{_token:$('meta[name="csrf-token"]').attr("content"),last_id:t,kind:"#messages"==e?1:2,room_id:$("#creativeroom_id").val()},success:function(t){$(e).prepend(t),$(e).scrollTop($(e).scrollTop()+100),setTimeout(function(){"#messages"==e?p():g()},200)},complete:function(){u=!0,$(".loading-text").addClass("hidden")}}))}function f(e,t){var s=c;(s||t)&&(u=!1,$(".loading-text").removeClass("hidden"),$.ajax({url:"/messages/crluo",type:"POST",dataType:"html",data:{_token:$('meta[name="csrf-token"]').attr("content"),last_id:s,kind:2,room_id:$("#creativeroom_id").val(),recipient_id:$("#creativeroom_users").val()},success:function(s){t?($(e).html(s),$(e).scrollTop(1e5)):($(e).prepend(s),$(e).scrollTop($(e).scrollTop()+100)),setTimeout(function(){g(),t?$(e).scrollTop(1e5):$(e).scrollTop($(e).scrollTop()+100)},200)},complete:function(){u=!0,$(".loading-text").addClass("hidden")}}))}$("#creativeroom_users").change(function(){c=0;var e=$("#creativeroom_id").val();""!=s&&window.Echo.leave(s),0!=$(this).val()&&(s="room."+e+"."+$(this).val(),window.Echo.private(s).listen("CrluoMessageReceived",function(t){s=e,i(t).appendTo("#crluo_messages"),$("#crluo_messages").scrollTop(1e5)})),f("#crluo_messages",!0)});var v=new qq.s3.FineUploader({element:document.getElementById("chat_uploader"),request:{endpoint:"https://"+bucketName+".s3-accelerate.amazonaws.com",accessKey:accessKey},signature:{endpoint:"/s3?room="+$("#creativeroom_id").val(),customHeaders:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}},validation:{sizeLimit:5368709120},chunking:{partSize:20971520},uploadSuccess:{endpoint:"/s3/success"},extraButtons:[{element:document.getElementById("message_file_upload")}],objectProperties:{key:function(e){new Date;return"files/"+$("#creativeroom_id").val()+"/"+v.getName(e)},acl:"public-read"},callbacks:{onComplete:function(e,t,s){var a=s.tempLink.split("?")[0],o=v.getFile(e).type;/^image/.test(o)||/^video/.test(o)?_(t)&&(n[e]={name:t,path:a,thumb:a.replace(t,"thumbnail_"+t)}):n[e]={name:t,path:a}},onSubmitted:function(e,t){if(/^video/.test(v.getFile(e).type)&&_(t)){a.push("thumbnail_"+t),$("#video").get(0).src=window.URL.createObjectURL(v.getFile(e));var s=document.getElementById("video");s.onloadeddata=function(){var e=document.getElementById("canvas"),n=function(e,t,s){e>s&&(t*=s/e,e=s);t>s&&(e*=s/t,t=s);return{width:e,height:t}}(s.videoWidth,s.videoHeight,200);e.width=n.width,e.height=n.height,e.getContext("2d").drawImage(s,0,0,n.width,n.height),v.addFiles({canvas:e,name:"thumbnail_"+t,type:"image/png"})}}/^image/.test(v.getFile(e).type)&&_(t)&&(a.push("thumbnail_"+t),v.drawThumbnail(e,document.getElementById("canvas"),200).done(function(e){v.addFiles({canvas:document.getElementById("canvas"),name:"thumbnail_"+t,type:"image/png"})}))},onValidate:function(){$("#fade-screen").show(),$("#chat_uploader .qq-upload-list-selector").show()},onAllComplete:function(){r=!0,$("#fade-screen").hide(),$("#chat_uploader .qq-upload-list-selector").hide(),n.length>0&&m("#messages")},onProgress:function(e,t,s,n){r=!1}}});function _(e){return-1==e.indexOf("thumbnail_")&&-1==a.indexOf(e)}function b(){return $(window).height()-$(".navbar-header").height()-$(".room-tabs").height()-$(".room-title").height()-35}v.addExtraDropzone(document.getElementById("custom_drop_zone")),$("#messages").on("dragover",function(e){e.stopPropagation(),e.preventDefault(),$("#custom_drop_zone").show()}),$("#custom_drop_zone").on("dragleave",function(e){e.stopPropagation(),$("#custom_drop_zone").hide()}),$("#custom_drop_zone").on("drop",function(e){e.stopPropagation(),$("#custom_drop_zone").hide()}),$(".qq-upload-drop-area").on("drop",function(e){e.stopPropagation(),$("#custom_drop_zone").hide()}),$(window).resize(function(){$(window).width()>992&&$("#room-body").height(b())}),$(window).width()>992&&$("#room-body").height(b()),$(document).on("click",".dropdown",function(e){e.stopPropagation()}),$(document).on("click",".ui-preview-movie li a",function(){$(this).parent(".video-menu").removeClass("open")}),Date.prototype.stringTime=function(){var e=this.getMonth()+1,t=this.getDate();return[this.getFullYear(),(e>9?"":"0")+e,(t>9?"":"0")+t,(this.getHours()>9?"":"0")+this.getHours(),(this.getMinutes()>9?"":"0")+this.getMinutes(),(this.getSeconds()>9?"":"0")+this.getSeconds()].join("")},Date.prototype.toSQLString=function(){var e=this.getMonth()+1,t=this.getDate();return[this.getFullYear(),(e>9?"":"0")+e,(t>9?"":"0")+t].join("-")+" "+[(this.getHours()>9?"":"0")+this.getHours(),(this.getMinutes()>9?"":"0")+this.getMinutes(),(this.getSeconds()>9?"":"0")+this.getSeconds()].join(":")},function(){var e,t=[].slice;e=function(){var e,s,n,a,o,i,r;return i=/(^|[\s\n]|<[A-Za-z]*\/?>)((?:https?|ftp):\/\/[\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~()_|])/gi,(o=1<=arguments.length?t.call(arguments,0):[]).length>0?(a=o[0],e=a.callback,n=function(){var e;e=[];for(s in a)r=a[s],"callback"!==s&&e.push(" "+s+"='"+r+"'");return e}().join(""),this.replace(i,function(t,s,a){return""+s+(("function"==typeof e?e(a):void 0)||"<a href='"+a+"'"+n+">"+a+"</a>")})):this.replace(i,"$1<a href='$2'>$2</a>")},String.prototype.autoLink=e}.call(this)}});